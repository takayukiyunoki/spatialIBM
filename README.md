# spatialIBM
R sources used by Yunoki, T. (2021) In a niche-neutral continuum, a set of theoretical models in a metacommunity operates simultaneously in patchy habitats

In this study, the interaction between ecological and evolutionary mechanisms was addressed by a spatially explicit synthesis between niche-based processes and neutral dynamics to explain the origin and maintenance of biodiversity. An individual-based model was implemented in a two-dimensional grid with periodic boundary conditions. By controlling the approximate scale of the system, the model communities (i.e., a metacommunity) in the center of the system had a fixed population size, and were selected from an area encompassing independent biogeographic units to an area packed in a biogeographic unit with open boundary conditions, and presented three environmental structures: four humps, linear, and random. The initial species pool in the system was varied by a large range of species-neutral and functional diversities. Across scenarios, the number of guilds in the system first reached a stationary state; then, the species richness eventually converged to a dynamical equilibrium through the speciation–extinction balance. In simulations, the environmental niche only affected the per capita probabilities of immigration success; then, the functional uniqueness in model communities increased and the relative portion explained by environmental component was maximum at the highest dispersal rate in an area packed within a biogeographic unit. The neutral dynamics among the species of a single guild; the patchy dynamics among the species of similar environmental optimum and different specialization levels; and the mass effect, such as weak species¬–environment association, operated in the spatial structures found within and among patchy habitats. Hence, in a niche-neutral continuum, a set of theoretical models in a metacommunity operates simultaneously in patchy habitats; the dispersal modes of biota may affect how the influence of environmental filtering changes across ecological–evolutionary scales. The general patterns observed in simulations allowed a theoretical synthesis on a metacommunity and helped to explain complex patterns observed in the real world.

A bit more support may be added for the Discussion section.
Now, the application of variation partitioning to the scenarios presented in Appendix B shows the problem of non-linear responses and spurious correlations more clearly, and the application of constrained randomization across scenarios shows its solution.
In the model communities with only one guild, the functional uniqueness was zero; however, the relative portion explained by the environmental component was positively biased in the linear environmental gradient, and the type I error of the pure environmental component was markedly inflated at the highest dispersal rate in an area packed within a biogeographic unit. In the model communities with two or more guilds, the functional uniqueness of complementary simulations was not approximated by the relative portion explained by the environmental component in the linear environmental gradient (Appendix Ba), and the power of the pure environmental component was maximum at the highest dispersal rate in an area packed within a biogeographic unit (Appendix Bb). In general, ND, PD, and weak species–environment associations were confused in the spatial structures found within and among patchy habitats. The species composition might be contrasted between opposite sides of the model communities because of the approximate scales of three for m = 0.01, nine for m = 0.09, and twenty-eight for m = 0.81. The orthogonal environmental variables were required to model non-linear responses, but might increase spurious correlations. However, this problem would eventually be solved by a constrained randomization of environmental variables conserving the original spatial structures and inter-correlations in environmental variables (Wagner & Dray, 2015; Clappe et al., 2018). It was noticed that a constrained randomization of the PCNM variables with positive eigenvalues built from the environmental distance but not only the first- and second-order orthogonal environmental variables would lead to an adjusted estimate and valid statistical test for assessing the influence of environmental filtering across scenarios (Appendix C-E). In this case, the spatial component of hierarchical model was often insignificant in the linear environmental gradient (Appendix Db), and the relative portion explained by the pure spatial component of hierarchical model was markedly decreased at the highest dispersal rate in an area packed within a biogeographic unit (Appendix Da and Ea). However, a constrained randomization of species composition conditioned by the hierarchical guild structure would lead to an adjusted estimate and valid statistical test for assessing the spatial component of hierarchical model, approximating the relative portion explained by the pure spatial component of overall model across scenarios (Appendix F and G). Hence, if the environmental component rather than the pure environmental component is significant, identifying the hierarchical guild structure may allow us to assess the link between theoretical models in each habitat type. 

Appendix B Summary statistics of the model communities that resulted in two or more guilds were compared across ecological–evolutionary scales in three environmental structures. In simulations, the environmental niche only affected the per capita birth–death rates. The model parameters were same as the scenarios presented in the main text, except for only the first population size of guilds was explored in the small system. (a) Functional uniqueness and redundancy were compared to the relative portions explained by environmental and pure spatial components in the total explained variation of overall model; then, the total explained variation and these relative portions were compared between overall and hierarchical models. The portions explained in hierarchical model were calculated for the scenarios in that the hierarchical guild structure was significant. vs.guild-habitat, the number of guilds coexisted in model communities was compared to the number of habitat types identified by hierarchical guild structure. (b) Power rate of all components in overall and hierarchical models. The number of model communities is provided within parentheses on the x-axis.   

Error in Appendix B submitted June 29, 2021: The number of model communities in the four humps environmental structure and dispersal rate m = 0.01 was 16 but not 17.  

Appendix C Constrained randomization of the PCNM variables with positive eigenvalues built from the environmental distance was applied to the scenarios presented in Figure 4. (a) Functional uniqueness and redundancy were compared to the relative portions explained by environmental and pure spatial components in total explained variation. (b) Type I error rate of environmental and pure environmental components and power rate of other components. The number of model communities is provided within parentheses on the x-axis.

Appendix D Constrained randomization of the PCNM variables with positive eigenvalues built from the environmental distance and the hierarchical guild structure were applied to the scenarios presented in Figure 5. (a) Functional uniqueness and redundancy were compared to the relative portions explained by environmental and pure spatial components in the total explained variation of overall model; then, the total explained variation and these relative portions were compared between overall and hierarchical models. The portions explained in hierarchical model were calculated for the scenarios in that the hierarchical guild structure was significant. vs.guild-habitat, the number of guilds coexisted in model communities was compared to the number of habitat types identified by hierarchical guild structure. (b) Power rate of all components in overall and hierarchical models. The number of model communities is provided within parentheses on the x-axis.   

Appendix E Constrained randomization of the PCNM variables with positive eigenvalues built from the environmental distance and the hierarchical guild structure were applied to the scenarios presented in Appendix B. (a) Functional uniqueness and redundancy were compared to the relative portions explained by environmental and pure spatial components in the total explained variation of overall model; then, the total explained variation and these relative portions were compared between overall and hierarchical models. The portions explained in hierarchical model were calculated for the scenarios in that the hierarchical guild structure was significant. vs.guild-habitat, the number of guilds coexisted in model communities was compared to the number of habitat types identified by hierarchical guild structure. (b) Power rate of all components in overall and hierarchical models. The number of model communities is provided within parentheses on the x-axis.

Appendix F Constrained randomization of the environmental variables and the species composition conditioned by the hierarchical guild structure were applied to the scenarios presented in Figure 5. Only the scenarios started from the first population size of guilds were used in the small system. (a) Functional uniqueness and redundancy were compared to the relative portions explained by environmental and pure spatial components in the total explained variation of overall model; then, the total explained variation and these relative portions were compared between overall and hierarchical models. The portions explained in hierarchical model were calculated for the scenarios in that the hierarchical guild structure was significant. vs.guild-habitat, the number of guilds coexisted in model communities was compared to the number of habitat types identified by hierarchical guild structure. (b) Power rate of all components in overall and hierarchical models. The number of model communities is provided within parentheses on the x-axis.   

Appendix G Constrained randomization of the environmental variables and the species composition conditioned by the hierarchical guild structure were applied to the scenarios presented in Appendix B. (a) Functional uniqueness and redundancy were compared to the relative portions explained by environmental and pure spatial components in the total explained variation of overall model; then, the total explained variation and these relative portions were compared between overall and hierarchical models. The portions explained in hierarchical model were calculated for the scenarios in that the hierarchical guild structure was significant. vs.guild-habitat, the number of guilds coexisted in model communities was compared to the number of habitat types identified by hierarchical guild structure. (b) Power rate of all components in overall and hierarchical models. The number of model communities is provided within parentheses on the x-axis.
